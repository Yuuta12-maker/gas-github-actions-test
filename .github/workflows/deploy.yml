name: Deploy to Google Apps Script

on:
  push:
    branches: [ main ]
  
jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '16'
        
    - name: Install Clasp
      run: npm install -g @google/clasp
      
    - name: Create clasprc.json
      run: |
        echo '${{ secrets.CLASPRC_JSON }}' > ~/.clasprc.json
        cat ~/.clasprc.json | grep "client_id" || echo "clasprc.json seems to be invalid"
    
    - name: Create clasp.json directly
      run: |
        echo '{
          "scriptId": "${{ secrets.SCRIPT_ID }}",
          "rootDir": "./src"
        }' > clasp.json
        cat clasp.json
    
    - name: Display directory structure
      run: |
        echo "Current directory:"
        pwd
        echo "Files in current directory:"
        ls -la
        echo "Files in src directory:"
        ls -la src
    
    - name: Test clasp login status
      run: clasp login --status || echo "Not logged in"
      
　　- name: Deploy with Clasp
 　　 run: clasp push -f
